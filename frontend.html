<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Generator Chat Interface</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            display: flex;
            height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
            background-color: white;
        }

        .preview-container {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header, .preview-header {
            padding: 15px;
            background-color: #4a154b;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            background-color: #e1f5fe;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background-color: #f1f1f1;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #ddd;
        }

        .chat-input textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: none;
            font-family: inherit;
        }

        .chat-input button {
            margin-left: 10px;
            padding: 0 20px;
            background-color: #4a154b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .chat-input button:hover {
            background-color: #611f69;
        }

        .preview-content {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            background-color: white;
            border: none;
            width: 100%;
            height: 100%;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .action-button {
            background-color: #4a154b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
        }

        .action-button:hover {
            background-color: #611f69;
        }

        .editing-tools {
            padding: 10px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tool-button {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
        }

        .tool-button:hover {
            background-color: #f1f1f1;
        }

        .typing-indicator {
            padding: 10px 15px;
            background-color: #f1f1f1;
            border-radius: 18px;
            margin-right: auto;
            border-bottom-left-radius: 5px;
            display: none;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #888;
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
            animation: typing 1s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        #editForm {
            display: none;
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -20%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            width: 80%;
            max-width: 600px;
        }

        #editForm textarea {
            width: 100%;
            height: 300px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
        }

        #editForm button {
            margin-right: 10px;
            padding: 8px 16px;
            background-color: #4a154b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header">
                <span>Blog Generator Assistant</span>
                <button class="action-button" id="clearChat">Clear Chat</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    Hello! I'm your blog generation assistant. What kind of blog would you like to create today?
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span></span><span></span><span></span>
            </div>
            <div class="chat-input">
                <textarea id="userInput" placeholder="Type your message here..." rows="3"></textarea>
                <button id="sendButton">Send</button>
            </div>
        </div>
        <div class="preview-container">
            <div class="preview-header">
                <span>Blog Preview</span>
                <div class="button-group">
                    <button class="action-button" id="editButton">Edit HTML</button>
                    <button class="action-button" id="copyButton">Copy HTML</button>
                    <button class="action-button" id="downloadButton">Download</button>
                </div>
            </div>
            <div class="editing-tools">
                <button class="tool-button" data-command="addHeading">Add Heading</button>
                <button class="tool-button" data-command="addParagraph">Add Paragraph</button>
                <button class="tool-button" data-command="addImage">Add Image</button>
                <button class="tool-button" data-command="changeStyle">Change Style</button>
                <button class="tool-button" data-command="addSubheading">Add Subheading</button>
            </div>
            <iframe id="previewFrame" class="preview-content"></iframe>
        </div>
    </div>

    <div id="overlay"></div>
    <div id="editForm">
        <h3>Edit HTML Content</h3>
        <textarea id="htmlEditor"></textarea>
        <button id="saveEdit">Save Changes</button>
        <button id="cancelEdit">Cancel</button>
    </div>

    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const previewFrame = document.getElementById('previewFrame');
        const clearChatButton = document.getElementById('clearChat');
        const editButton = document.getElementById('editButton');
        const copyButton = document.getElementById('copyButton');
        const downloadButton = document.getElementById('downloadButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const editForm = document.getElementById('editForm');
        const htmlEditor = document.getElementById('htmlEditor');
        const saveEditButton = document.getElementById('saveEdit');
        const cancelEditButton = document.getElementById('cancelEdit');
        const overlay = document.getElementById('overlay');
        const toolButtons = document.querySelectorAll('.tool-button');

        // Initialize preview with empty HTML
        updatePreview('<!DOCTYPE html><html><head><title>Blog Preview</title></head><body><h1>Your Blog Preview Will Appear Here</h1><p>Start a conversation to generate blog content.</p></body></html>');

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        clearChatButton.addEventListener('click', clearChat);
        editButton.addEventListener('click', openHtmlEditor);
        copyButton.addEventListener('click', copyHtmlToClipboard);
        downloadButton.addEventListener('click', downloadHtml);
        saveEditButton.addEventListener('click', saveHtmlChanges);
        cancelEditButton.addEventListener('click', closeHtmlEditor);
        overlay.addEventListener('click', closeHtmlEditor);

        // Tool buttons event listeners
        toolButtons.forEach(button => {
            button.addEventListener('click', () => handleToolAction(button.dataset.command));
        });

        // Simulated backend connection
        let lastBlogHtml = '';
        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            userInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            try {
                // Simulate sending to backend
                const response = await simulateBackendResponse(message);
                
                // Hide typing indicator after response received
                typingIndicator.style.display = 'none';
                
                // Add bot response to chat
                addMessageToChat(response.message, 'bot');
                
                // Update preview if HTML is returned
                if (response.html) {
                    lastBlogHtml = response.html;
                    updatePreview(response.html);
                }
            } catch (error) {
                typingIndicator.style.display = 'none';
                addMessageToChat('Sorry, there was an error processing your request.', 'bot');
                console.error('Error:', error);
            }
        }

        function addMessageToChat(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function updatePreview(html) {
            const frameDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            frameDoc.open();
            frameDoc.write(html);
            frameDoc.close();
        }

        function clearChat() {
            chatMessages.innerHTML = '';
            addMessageToChat('Hello! I'm your blog generation assistant. What kind of blog would you like to create today?', 'bot');
            updatePreview('<!DOCTYPE html><html><head><title>Blog Preview</title></head><body><h1>Your Blog Preview Will Appear Here</h1><p>Start a conversation to generate blog content.</p></body></html>');
            lastBlogHtml = '';
        }

        function openHtmlEditor() {
            if (!lastBlogHtml) {
                lastBlogHtml = previewFrame.contentDocument.documentElement.outerHTML;
            }
            htmlEditor.value = lastBlogHtml;
            editForm.style.display = 'block';
            overlay.style.display = 'block';
        }

        function closeHtmlEditor() {
            editForm.style.display = 'none';
            overlay.style.display = 'none';
        }

        function saveHtmlChanges() {
            const newHtml = htmlEditor.value;
            lastBlogHtml = newHtml;
            updatePreview(newHtml);
            closeHtmlEditor();
            addMessageToChat('I\'ve updated the blog with your HTML edits.', 'bot');
        }

        function copyHtmlToClipboard() {
            const html = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
            navigator.clipboard.writeText(html).then(() => {
                alert('HTML copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }

        function downloadHtml() {
            const html = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
            const blob = new Blob([html], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-blog.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function handleToolAction(command) {
            let message = '';
            switch(command) {
                case 'addHeading':
                    message = 'Add a main heading that says "The Future of AI in Healthcare"';
                    break;
                case 'addParagraph':
                    message = 'Add a paragraph about the benefits of AI in modern healthcare';
                    break;
                case 'addImage':
                    message = 'Add an image of AI in healthcare to the blog';
                    break;
                case 'changeStyle':
                    message = 'Change the blog style to use blue headings and a serif font';
                    break;
                case 'addSubheading':
                    message = 'Add a subheading called "Key Benefits of AI"';
                    break;
            }
            
            if (message) {
                userInput.value = message;
                sendMessage();
            }
        }

        // This function simulates the backend API
        async function simulateBackendResponse(message) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            if (message.toLowerCase().includes('blog') && message.toLowerCase().includes('write') || 
                message.toLowerCase().includes('create') || message.toLowerCase().includes('generate')) {
                // Generate a simple blog HTML as an example
                let topic = message.match(/about\s+([^?.,]+)/i)?.[1] || 'technology';
                
                return {
                    message: `I've created a blog post about ${topic}. You can see it in the preview pane, and use the editing tools or the Edit HTML button to make changes.`,
                    html: generateSampleBlog(topic)
                };
            } 
            else if (message.toLowerCase().includes('add heading') || message.toLowerCase().includes('main heading')) {
                const headingText = message.match(/heading\s+(?:that\s+says\s+)?"([^"]+)"/i)?.[1] || 
                                    message.match(/heading\s+(?:that\s+says\s+)?'([^']+)'/i)?.[1] || 
                                    'New Heading';
                                    
                let currentHtml = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
                let newHtml = addHeadingToHtml(currentHtml, headingText);
                
                return {
                    message: `I've added the heading "${headingText}" to your blog.`,
                    html: newHtml
                };
            }
            else if (message.toLowerCase().includes('add paragraph')) {
                const match = message.match(/paragraph\s+about\s+([^.,?]+)/i);
                const topic = match?.[1] || 'the topic';
                
                let currentHtml = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
                let newHtml = addParagraphToHtml(currentHtml, topic);
                
                return {
                    message: `I've added a paragraph about ${topic} to your blog.`,
                    html: newHtml
                };
            }
            else if (message.toLowerCase().includes('add image')) {
                const match = message.match(/image\s+of\s+([^.,?]+)/i);
                const imageDesc = match?.[1] || 'the topic';
                
                let currentHtml = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
                let newHtml = addImageToHtml(currentHtml, imageDesc);
                
                return {
                    message: `I've added an image related to ${imageDesc} to your blog.`,
                    html: newHtml
                };
            }
            else if (message.toLowerCase().includes('change style')) {
                let currentHtml = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
                let newHtml = changeStyleInHtml(currentHtml, message);
                
                return {
                    message: `I've updated the styling of your blog according to your request.`,
                    html: newHtml
                };
            }
            else if (message.toLowerCase().includes('add subheading')) {
                const match = message.match(/subheading\s+(?:called\s+)?"([^"]+)"/i)?.[1] || 
                              message.match(/subheading\s+(?:called\s+)?'([^']+)'/i)?.[1] || 
                              'New Subheading';
                
                let currentHtml = lastBlogHtml || previewFrame.contentDocument.documentElement.outerHTML;
                let newHtml = addSubheadingToHtml(currentHtml, match);
                
                return {
                    message: `I've added the subheading "${match}" to your blog.`,
                    html: newHtml
                };
            }
            else {
                return {
                    message: `I understand you want to ${message}. To create a blog, please say something like "Generate a blog about [topic]" or use the editing tools on the right.`
                };
            }
        }

        // Helper function to generate a sample blog
        function generateSampleBlog(topic) {
            return `<!DOCTYPE html>
<html>
<head>
  <title>Blog About ${capitalizeFirstLetter(topic)}</title>
  <style>
     body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: auto; padding: 20px; }
     img { max-width: 100%; height: auto; display: block; margin: 20px 0; }
     h1, h2 { color: #333; }
     p { color: #555; }
  </style>
</head>
<body>
  <h1>The Future of ${capitalizeFirstLetter(topic)}</h1>
  <p>In today's rapidly evolving technological landscape, ${topic} stands at the forefront of innovation. This blog explores the latest trends and future prospects of ${topic} in our everyday lives.</p>
  
  <h2>Current Trends in ${capitalizeFirstLetter(topic)}</h2>
  <p>The ${topic} industry has seen remarkable growth in recent years. Experts predict that this trend will continue as more businesses and consumers recognize the benefits of integrating ${topic} into their operations and lifestyles.</p>
  
  <img src="/api/placeholder/800/400" alt="${topic} illustration">
  
  <h2>Benefits of ${capitalizeFirstLetter(topic)}</h2>
  <p>There are numerous advantages to adopting ${topic} solutions. From increased efficiency to cost savings, the positive impacts are undeniable. Organizations that have embraced ${topic} report significant improvements in productivity and customer satisfaction.</p>
  
  <h2>Challenges and Considerations</h2>
  <p>Despite its benefits, implementing ${topic} comes with certain challenges. These include initial investment costs, training requirements, and potential resistance to change. However, with proper planning and execution, these obstacles can be overcome.</p>
  
  <img src="/api/placeholder/800/400" alt="${topic} implementation">
  
  <h2>Looking Ahead</h2>
  <p>The future of ${topic} looks promising. As technology continues to advance, we can expect even more innovative applications and solutions. Staying informed about these developments will be crucial for businesses and individuals looking to stay competitive in an increasingly digital world.</p>
  
  <p>In conclusion, ${topic} represents a significant opportunity for growth and improvement across various sectors. By understanding its potential and addressing its challenges, we can harness the full power of ${topic} to create a better future.</p>
</body>
</html>`;
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // HTML manipulation functions
        function addHeadingToHtml(html, headingText) {
            // Find body tag
            const bodyStart = html.indexOf('<body>');
            const bodyContent = html.substring(bodyStart + 6);
            
            // Add heading after body tag
            return html.substring(0, bodyStart + 6) + 
                   `\n  <h1>${headingText}</h1>\n` + 
                   bodyContent;
        }

        function addParagraphToHtml(html, topic) {
            // Sample paragraphs based on topics
            const paragraphs = {
                'benefits': `The benefits are numerous and far-reaching. Studies have shown significant improvements in efficiency, cost reduction, and overall satisfaction when properly implemented. Organizations that have adopted these approaches report up to 40% increases in productivity and substantial gains in competitive advantage.`,
                'AI': `Artificial Intelligence continues to revolutionize industries across the globe. By automating complex tasks and providing data-driven insights, AI empowers businesses to make better decisions and innovate faster than ever before. From natural language processing to machine learning algorithms, the applications are virtually limitless.`,
                'healthcare': `Modern healthcare systems are being transformed through technological innovation. Patient outcomes are improving while costs are being reduced through more efficient processes. Electronic health records, telemedicine, and AI-assisted diagnostics are just a few examples of how technology is enhancing the quality of care available to patients worldwide.`,
                'default': `This represents an important aspect of the topic that deserves careful consideration. Experts in the field have conducted extensive research and found compelling evidence supporting these approaches. The implications extend far beyond immediate applications and suggest promising future developments.`
            };
            
            // Find the best matching paragraph or use default
            let paragraphText = paragraphs.default;
            for (const [key, value] of Object.entries(paragraphs)) {
                if (topic.toLowerCase().includes(key.toLowerCase())) {
                    paragraphText = value;
                    break;
                }
            }
            
            // Find closing body tag
            const bodyEnd = html.indexOf('</body>');
            
            // Add paragraph before closing body tag
            return html.substring(0, bodyEnd) + 
                   `\n  <p>${paragraphText}</p>\n` + 
                   html.substring(bodyEnd);
        }

        function addImageToHtml(html, imageDesc) {
            // Find closing body tag
            const bodyEnd = html.indexOf('</body>');
            
            // Add image before closing body tag
            return html.substring(0, bodyEnd) + 
                   `\n  <img src="/api/placeholder/800/400" alt="${imageDesc} image">\n` + 
                   html.substring(bodyEnd);
        }

        function changeStyleInHtml(html, styleRequest) {
            // Extract style block
            const styleStart = html.indexOf('<style>');
            const styleEnd = html.indexOf('</style>');
            
            if (styleStart === -1 || styleEnd === -1) return html;
            
            let styleBlock = html.substring(styleStart + 7, styleEnd);
            
            // Apply requested style changes
            if (styleRequest.toLowerCase().includes('blue')) {
                styleBlock = styleBlock.replace(/h1, h2 \{ color: #[0-9a-f]+;/i, 'h1, h2 { color: #2c3e50;');
            }
            
            if (styleRequest.toLowerCase().includes('serif')) {
                styleBlock = styleBlock.replace(/font-family: [^;]+;/i, 'font-family: Georgia, serif;');
            }
            
            // Replace the style block
            return html.substring(0, styleStart + 7) + styleBlock + html.substring(styleEnd);
        }

        function addSubheadingToHtml(html, subheadingText) {
            // Find closing body tag
            const bodyEnd = html.indexOf('</body>');
            
            // Add subheading before closing body tag
            return html.substring(0, bodyEnd) + 
                   `\n  <h2>${subheadingText}</h2>\n` + 
                   html.substring(bodyEnd);
        }
    </script>
</body>
</html>